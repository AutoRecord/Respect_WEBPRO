# WEBPRO入力シート統合検討資料

## 1. 現状の構造分析

### 入力シートの構成（27シート）

| カテゴリ | シート名 | 行数 | 列数 | 備考 |
|---------|---------|------|------|------|
| 基本 | 0) 基本情報 | 21 | 5 | 縦型フォーム形式 |
| 共通 | 1) 室仕様 | 9 | 14 | ヘッダー+データ行 |
| 空調 | 2-1) 空調ゾーン | 217 | 15 | 選択肢リスト含む |
| 空調 | 2-2) 外壁構成 | 1000 | 14 | 建材リスト含む |
| 空調 | 2-3) 窓仕様 | 166 | 11 | 窓仕様リスト含む |
| 空調 | 2-4) 外皮 | 9 | 11 | |
| 空調 | 2-5) 熱源 | 101 | 26 | 熱源機種リスト含む |
| 空調 | 2-6) 2次ポンプ | 9 | 11 | |
| 空調 | 2-7) 空調機 | 9 | 26 | |
| 空調 | 2-8) 熱源水温度 | 9 | 13 | |
| 空調 | 2-9) 全熱交換器 | 9 | 20 | |
| 空調 | 2-10) 変流量二次ポンプ | 8 | 10 | |
| 空調 | 2-11) PAC部分負荷特性 | 5 | 9 | |
| 換気 | 3-1) 換気室 | 9 | 8 | |
| 換気 | 3-2) 換気送風機 | 9 | 7 | |
| 換気 | 3-3) 換気空調機 | 8 | 12 | |
| 換気 | 3-4) 年間平均負荷率 | 9 | 3 | |
| 照明 | 4) 照明 | 9 | 18 | |
| 給湯 | 5-1) 給湯室 | 9 | 9 | |
| 給湯 | 5-2) 給湯機器 | 9 | 10 | |
| 昇降機 | 6) 昇降機 | 9 | 11 | |
| 効率化 | 7-1) 太陽光発電 | 9 | 8 | |
| 効率化 | 7-3) コージェネ | 8 | 17 | |
| 外皮 | 8) 非空調外皮 | 9 | 15 | |
| マスター | 地域の区分 | 2011 | 6 | 統合不要 |
| マスター | data | 218 | 37 | 選択肢マスター・統合不要 |

### 各シートの共通構造

```
Row 0: 様式タイトル（例：「様式 1. (共通)室仕様 Rev.2」）
Row 1-4: 空白または番号ラベル（①②③...）
Row 5: 項目名ヘッダー（階、室名、室用途、室面積...）
Row 6: 空白
Row 7: 単位行（[㎡]、[m]、[kW]...）
Row 8: 入力タイプ（(転記)、(選択)...）
Row 9以降: 実際のデータ入力行
```

---

## 2. 統合アプローチの比較

### アプローチA: 1シートに全データを統合
**メリット:**
- `pd.read_excel()` 1回で全データ読み込み可能
- シンプルな構造

**デメリット:**
- 列が異なるシートを横に並べると冗長
- データ型が混在して扱いにくい

### アプローチB: 各様式を別シートとして統合（推奨）
**メリット:**
- 同じ構造のデータが1シートにまとまる
- Python側で `sheet_name` 指定で必要なデータだけ取得可能
- 元の様式構造を維持しやすい

**デメリット:**
- 複数シートを扱う必要がある（大きな問題ではない）

### アプローチC: カテゴリ別に統合
空調系を1シート、換気系を1シートなど。中間的なアプローチ。

---

## 3. 推奨方式（アプローチB）の詳細設計

### 統合後のExcelファイル構造

```
統合ファイル名: webpro_combined_data.xlsx

シート構成:
├── 00_基本情報          ← 100件分の建物基本情報
├── 01_室仕様            ← 100件分の室データ
├── 02_空調ゾーン        ← 100件分の空調ゾーン
├── 03_外壁構成          ← 100件分の外壁構成
├── 04_窓仕様            ← 100件分の窓仕様
├── 05_外皮              ← 100件分の外皮
├── 06_熱源              ← 100件分の熱源
├── 07_二次ポンプ        ← 100件分の二次ポンプ
├── 08_空調機            ← 100件分の空調機
├── 09_熱源水温度        ← （任意評定用）
├── 10_全熱交換器        ← 100件分の全熱交換器
├── 11_換気室            ← 100件分の換気室
├── 12_換気送風機        ← 100件分の換気送風機
├── 13_換気空調機        ← 100件分の換気空調機
├── 14_照明              ← 100件分の照明
├── 15_給湯室            ← 100件分の給湯室
├── 16_給湯機器          ← 100件分の給湯機器
├── 17_昇降機            ← 100件分の昇降機
├── 18_太陽光発電        ← 100件分の太陽光発電
├── 19_コージェネ        ← 100件分のコージェネ
└── 20_非空調外皮        ← 100件分の非空調外皮
```

### 統合後のデータ形式（各シート共通）

| file_id | building_name | 階 | 室名 | 室用途_大分類 | 室用途_小分類 | 室面積 | ... |
|---------|---------------|-----|------|---------------|---------------|--------|-----|
| 001 | 〇〇ビル | 1F | 事務室A | 事務所等 | 事務室 | 120.5 | ... |
| 001 | 〇〇ビル | 1F | 会議室 | 事務所等 | 会議室 | 30.0 | ... |
| 002 | △△ビル | 1F | ロビー | 事務所等 | ロビー | 200.0 | ... |
| ... | ... | ... | ... | ... | ... | ... | ... |

**ポイント:**
- `file_id`: 元ファイルを識別するID（001〜100）
- `building_name`: 基本情報シートの建物名称を自動付与
- 空白行・ヘッダー行は除去し、データ行のみ統合

---

## 4. Python読み込み例

### 全シート一括読み込み
```python
import pandas as pd

# 全シートを辞書で読み込み
all_data = pd.read_excel('webpro_combined_data.xlsx', sheet_name=None)

# 特定シートの確認
df_rooms = all_data['01_室仕様']
df_hvac = all_data['02_空調ゾーン']
df_lighting = all_data['14_照明']

# 特定の建物だけ抽出
building_001 = df_rooms[df_rooms['file_id'] == '001']
```

### 必要なシートだけ読み込み
```python
# 照明データだけ必要な場合
df_lighting = pd.read_excel(
    'webpro_combined_data.xlsx',
    sheet_name='14_照明'
)

# 複数シートを指定
dfs = pd.read_excel(
    'webpro_combined_data.xlsx',
    sheet_name=['01_室仕様', '14_照明', '06_熱源']
)
```

### 建物単位での集計例
```python
# 建物ごとの室面積合計
room_area_summary = df_rooms.groupby('file_id')['室面積'].sum()

# 建物ごとの熱源機器台数
heatsource_count = df_heatsource.groupby('file_id')['台数'].sum()
```

---

## 5. 統合スクリプトの構成案

```
webpro_consolidator/
├── consolidate.py       # メインスクリプト
├── config.py            # シート名マッピング等の設定
├── utils.py             # ユーティリティ関数
├── input_files/         # 100個の入力ファイルを配置
│   ├── building_001.xlsx
│   ├── building_002.xlsx
│   └── ...
└── output/
    └── webpro_combined_data.xlsx
```

### consolidate.py の処理フロー

1. input_files/ から全ファイルをリストアップ
2. 各ファイルからシートごとにデータ抽出
   - ヘッダー行（Row 5）を取得
   - 単位行（Row 7）からカラム名に単位を追加
   - データ行（Row 9以降）を取得
   - 空白行を除去
   - file_id と building_name を付与
3. 同じシートのデータを縦に結合（pd.concat）
4. 1つのExcelファイルに全シートを出力

---

## 6. 注意点・検討事項

### 6.1 基本情報シートの特殊構造
- 他のシートと異なり縦型フォーム形式
- キー・バリュー形式で抽出し、横型に変換する必要あり

### 6.2 選択肢リストの扱い
- 一部シートの右側には選択肢リスト（プルダウン用）が存在
- データ列とリスト列を分離して抽出する必要あり

### 6.3 データ検証
- 統合後にデータ件数が正しいか確認
- 欠損値の扱いを定義

### 6.4 ファイル命名規則
- 100ファイルに一貫した命名規則があると処理しやすい
- 例: `{建物ID}_{建物名}.xlsx` または `webpro_001.xlsx`

---

## 7. 次のステップ

1. **上司に確認すべき事項:**
   - 100ファイルの現在の命名規則・保存場所
   - 統合後に特に重視するシート（全シート必要か）
   - Python処理の目的（集計？レポート？API連携？）

2. **実装作業:**
   - 統合スクリプトの作成
   - テスト用に5〜10ファイルで動作確認
   - 100ファイルで本番実行

---

## 8. まとめ

| 項目 | 推奨内容 |
|------|----------|
| 統合方式 | 各様式を別シートとして1ファイルに統合 |
| ファイル形式 | Excel (.xlsx) |
| 識別子 | file_id列を追加して元ファイルを識別 |
| ヘッダー | 項目名＋単位を結合したカラム名 |
| Python読み込み | pd.read_excel(sheet_name=None) で辞書取得 |
